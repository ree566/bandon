$(function () {

    $("form").parent().removeClass();

    $('.input-daterange').datetimepicker({
        collapse: true,
        useCurrent: true,
        // sideBySide: true,
        format: 'YYYY/M/DD HH:mm',
        showClear: true,
        allowInputToggle: true,
        stepping: 15
    });

    $("#date-set-all").on("dp.change", function () {
        var d = $(this).find("input").val();
        $('.input-daterange').each(function () {
            if (d == "") {
                $(this).data("DateTimePicker").clear()
            } else {
                $(this).data("DateTimePicker").date(d);
            }
        });
    });

    $("#highlight-all").on("click", function () {
        var d = $(this).is(":checked");
        $('.highlight > input[type="checkbox"]').each(function () {
            $(this).prop('checked', d);
        });
    });

    $(".submit").on("click", function () {
        if (confirm("確認儲存?")) {

            var c = [];

            function a() {
                alert("儲存成功！");
                location.replace("manage-time-limit.php");
            }

            function b() {
                alert("發生錯誤！");
            }

            $(".group").each(function () {
                var group_id = $(".group_id", this).html();
                var time_limit = $(".input-daterange", this).find("input").val();
                var highlight = $('.highlight > input[type="checkbox"]', this).is(":checked");

                var obj = {
                    group_id: group_id,
                    floor_id: floor_id,
                    time_limit: time_limit,
                    highlight: highlight ? 1 : 0
                };

                if (time_limit == "") {
                    delete obj.time_limit;
                }

                c.push(obj);

            });

            var data = {
                groups: c
            };

            console.log(data);
            return myPost("set-time-limit", data, a, b, this);
        }
        return false;
    });

});

