$(function () {

    $("form").parent().removeClass();

    $(".submit").click(function () {

        function a(d) {
            var arr = d["purse_event"];

            if (arr.length == 0) {
                alert("No data.");
                return false;
            }

            var tableBody = $("tbody");
            tableBody.html("");
            for (var i = 0; i < arr.length; i++) {
                var obj = arr[i];
                var str = "";
                str = str.concat("<tr>");

                str = str.concat("<td>");
                str = str.concat(obj["purse_event_id"]);
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(obj["purse_user_name"]);
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(obj["item_kind"] == null ? "X" : (obj["item_kind"] + "x" + obj["order_number"]));
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat((obj["order_id"] ? -(obj["order_number"] * obj["kind_price"]) : obj["amount"]));
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(formatDate(obj["mod_date"]));
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(obj["mod_user_name"]);
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(formatDate(obj["mod_date"]));
                str = str.concat("</td>");

                str = str.concat("<td>");
                str = str.concat(obj["remark"]);
                str = str.concat("</td>");

                str = str.concat("</tr>");

                tableBody.append(str);
            }
        }

        function b() {
            alert("發生錯誤！");
        }

        var data = {
            user_id: $("#user_id").val(),
            user_name: $("#user_name").val()
        };

        return myPost("get-purse-event", data, a, b, this);

    });

    $("#user_id, #user_name").on("keyup", function () {
        $(this).val($(this).val().trim().toUpperCase());
    });

    function formatDate(d) {
        return d == null ? 'n/a' : d.substring(0, 10);
    }
});

