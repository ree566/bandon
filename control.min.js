/*! bandon 2014-08-14 */ ! function() {
    function a(a) {
        return T("{}-{}-{}", [a.item_id, a.kind_id, a.options.map(function(a) {
            return a.id
        }).join("-")])
    }

    function b() {
        function a(a) {
            g = a.orders, c()
        }

        function b(a) {
            alert("取得訂購資料失敗！")
        }
        myPost("get-orders", "", a, b)
    }

    function c() {
        d(), f();
        var a = document.querySelector("a[href='clean.php']");
        a.onclick = function() {
            return confirm("確定要清空？所有的訂購資料即將刪除！")
        }, $("table").each(function() {
            sorttable.makeSortable(this)
        })
    }

    function d() {
        h = {}, i = {}, g.forEach(function(b) {
            i[b.user_id] || (i[b.user_id] = 0);
            var c = b.group.id;
            h[c] || (h[c] = {
                name: b.group.name,
                items: {},
                total: 0
            });
            var d = a(b);
            h[c].items[d] || (h[c].items[d] = {
                name: b.item.name,
                kind: b.kind,
                options: b.options,
                number: 0
            }), h[c].items[d].number += 1 * b.number
        });
        for (var b in h) {
            var c = h[b];
            c.total = 0;
			c.numbers = 0;
            for (var d in c.items) {
                var f = c.items[d];
                c.total += e(f) * f.number;
				c.numbers += f.number;
            }
        }
    }

    function e(a) {
        var b = 0;
        return b += 1 * a.kind.price, a.options.forEach(function(a) {
            b += 1 * a.detail.price
        }), b
    }

    function f() {
        function a(a) {
            return a.name
        }

        function b(a) {
            return 1 * a.detail.price
        }
        var c, d = [];
        for (c in h) {
            var e = h[c],
                f = [];
            for (var g in e.items) {
                var j = e.items[g],
                    k = j.options.map(a),
                    l = sum(j.options.map(b));
                f.push(T('<tr>'+
						'<td>{item_name} {kind_name}</td>'+
						'<td>{options}</td>'+
						'<td>{number}</td>'+
						'<td>{price}</td>'+
						'<td>{total}</td>'+
						'</tr>', {
                    item_name: j.name,
                    kind_name: j.kind.name,
                    options: k.join(" "),
                    price: 1 * j.kind.price + l,
                    number: j.number,
                    total: (1 * j.kind.price + l) * j.number
                }))
            }

            d.push(T('<div class="panel panel-default">'+
					'<div class="panel-heading">{group_name}</div>'+
					'<table class="group table text-left sortable table-striped"><thead>'+
					'<tr><th>項目</th>'+
					'<th>細項</th>'+
					'<th>數量</th>'+
					'<th>單價</th>'+
					'<th>總價</th>'+
					'</tr></thead>'+
					'<tbody>{items}</tbody>'+
					'<tfoot><tr><th>Total</th>'+
					'<td></td>'+
					'<td>{numbers}</td>'+
					'<td></td>'+
					'<td>{total}</td></tr></tfoot></table></div>', {
                group_name: e.name,
				numbers: e.numbers, 
                items: f.join(""),
                total: e.total
            }))
        }
        $(".groups-detail").html(d.join(""));
        var m = 0;
        for (c in h) m += h[c].total;
        $(".system-status").html("已訂購人數︰" + count(i) + "<br>總價︰" + m + "元")
    }
    var g = null,
        h = null,
        i = null;
    $(document).ready(b)
}();
//# sourceMappingURL=control.min.js.map